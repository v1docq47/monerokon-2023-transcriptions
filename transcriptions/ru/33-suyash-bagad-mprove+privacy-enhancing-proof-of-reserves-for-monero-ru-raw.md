# Суяш Багад

_**MProve+: повышающее уровень приватности доказательство резервов для Monero**_

[https://youtu.be/fTFnp1xWCpk](https://youtu.be/fTFnp1xWCpk)

---

_**Суяш:**_ Всем привет! Моё выступление не будет долгим, поскольку на сегодня это последнее выступление. Меня зовут Суяш. В настоящее время я работаю в Aztec Protocol, а то, что я сегодня представлю, было сделано в рамках моей магистерской диссертации. Мы поговорим об MProove+, повышающем уровень приватности доказательстве резервов для криптовалютных бирж и, в частности, для Monero. То есть, речь пойдёт о криптографическом протоколе. Я не стану вдаваться в математические подробности, а просто постараюсь сделать общий обзор того, что мы называем доказательствами резервов, и разъяснить, в чём суть этой технологии.

Итак, биржи. Согласно известному утверждению: не ваш ключ - не ваши монеты. При этом многие хранят или торгуют криптовалютами и имеют счета на криптовалютных биржах, что упрощает процесс вовлечения в эту деятельность и саму торговлю в принципе. Но проблема состоит в том, что вам приходится доверять криптовалютной бирже, которая обещает хранить ваши ключи в безопасности, что, судя по всему, вовсе не так. Есть множество примеров взлома, обмана и мошенничества, связанного с выводом средств. Взять ту же сагу с FTX, когда депозиты пользователей использовались не по назначению. И мы наблюдаем подобные неблагоприятные сценарии, начиная с 2014 года или даже раньше. Так, например, взлом Mt. Gox в 2014 году стал крупнейшим из подобных событий. Имели место такие аферы, как в случае с QuadrigaCX, который до сих пор остаётся загадкой, и о котором Netflix даже сняли документальный фильм. Из недавних случаев приходит на ум уже упомянутая мной FTX. Всё это, разумеется, не очень благоприятно с точки зрения пользователя. И когда мы говорим о массовом внедрении криптовалюты, криптовалютные биржи кажутся единственным, пусть не единственным, но одним из главных инструментов, позволяющих осуществить это. Но если подобное будет продолжаться, нам потребуются какие-то решения.

Одно из решений, которое не очень популярно, аппаратные кошельки, на которых хранятся ваши закрытые ключи при отсутствии прямого взаимодействия с интернетом. Это считается более безопасным способом, чем тот, что предлагают биржи. Но, опять же, это слишком сложно для обычных людей. И мы по-прежнему далеки от внедрения таких вещей, как кредитные карты или тот же аппаратный кошелёк, который помещается в карту и может использоваться для совершения платежей и так далее. Поэтому в настоящее время это нельзя считать жизнеспособным решением для большинства обычных людей.

Как вариант можно было бы решить проблему бирж, то есть, изменить присущий им доверительный характер. Мы могли бы обеспечить необходимый уровень доверия с помощью математики, реализовав доказательства платёжеспособности. То есть, если биржа будет способна доказать, что объём имеющихся у неё резервов превышает объём обязательств, тогда, по крайней мере, мы могли бы быть уверены, что в случае взлома или при любых других неблагоприятных сценариях пользователям смогут вернуть свои с трудом заработанные средства.

Однако проблема заключается в том, что использование доказательств платёжеспособности или доказательств владения активами, о которых столько говорится, может привести к раскрытию чувствительной информации о бирже. Так, например, после проблем с FTX, Binance опубликовали список своих адресов, на которых в совокупности хранилось 69 миллиардов долларов или около того. Но это довольно плохо для самой Binance или их бизнеса, поскольку бирже пришлось раскрыть чувствительную информацию, связанную с её активами. Да, это можно сделать в случае с публичными блокчейнами, такими как Bitcoin или Ethereum, где вы можете видеть баланс по тому или иному адресу. Но как быть с приватными блокчейнами, такими как Monero, где увидеть баланс невозможно? Так что, это лишь один из спорных аспектов доказательства платёжеспособности или доказательством владения активами.

А что насчёт обязательств? Под обязательствами, как правило, понимается сумма, которую пользователи внесли на криптовалютную биржу, и которую биржа должна пользователям. Доказательство обязательств ещё сложнее, поскольку для биржи проблематично раскрыть данные клиентов. Поэтому с доказательствами владения активами работать немного проще, чем с доказательствами обязательств.

Так что вернёмся к доказательствам владения активами, поскольку сегодня мы будем говорить только о них. Разработанный нами протокол является протоколом доказательства резервов или доказательства владения активами. И ключевая идея в случае с блокчейном, подобным блокчейну Monero, сводится к доказательству отношения, согласно которому активы минус обязательства должны составлять больше нуля. И мы можем реализовать эту идею с помощью криптографических обязательств. Допустим, C является обязательством, простите, C будет у нас генератором. То есть генератор в степени Assets будет нашим обязательством по имеющимся активам. Генератор в степени Liabilities будет криптографическим обязательством по общим обязательствам биржи, и если умножить CAssets на C–Liabilities и доказать, что значение обязательства не является нулевым, то есть, оно выше нуля, то этого будет достаточно, чтобы доказать, что объём имеющихся активов больше тех, по которым имеется обязательство. Такова наша основная идея.

И есть несколько проблем, которые нужно решить, прежде чем мы начнём использовать предлагаемое равенство. Во-первых, доказать наличие резервов в Monero очень сложно. Поэтому этот протокол при разработке прошёл две итерации. Его первая версия называется MProve, а вторая - MProve+. У версии MProve был большой недостаток, который мы сейчас рассмотрим. Мы также обсудим, почему доказательства резервов так трудно реализовать.

Итак, как правило, при создании транзакций Monero используются кольцевые подписи, позволяющие скрыть реальный адрес, используемый в конкретном кольце. И если P - это открытый ключ, обозначенный зелёным кружком, вы просто доказываете, что владеете одним открытым ключом из 11 или любого другого количества ключей в зависимости от размера кольца. И вместе с этим открытым ключом требуется предоставить некоторую другую информацию, а именно так называемый «образ ключа», исключающий возможность двойное использование этого адреса. Как я уже говорил, кольцевая подпись, по сути, доказывает, что отправителю транзакции известен один из закрытых ключей, соответствующих открытым ключам, составляющим кольце, а образ ключа защищает от двойной траты.

Протокол доказательства резервов, о котором мы сегодня поговорим, в основе обеих его версий лежат схожие принципы, поскольку, по сути, биржа хочет доказать, что ей принадлежат определённые адреса, на которых находится определённое количество денег, и сумма этих денег должна быть выше порогового значения. Как уже было сказано, основная идея заключается в том, что обычная транзакция Monero содержит только один открытый ключ, доказывающий владение средствами. Но теперь нам нужно нечто большее. Нам необходимо доказать, что существует некий огромный набор неизрасходованных транзакций, на основе которых криптовалютная биржа сможет доказать, что владеет определённым подмножеством бирж.

Протокол MProve работает довольно просто. Допустим, этот набор зелёных адресов принадлежит бирже. Первое, что сделает биржа, это выберет анонимную группу, чтобы скрыть свои адреса, как в случае с транзакциями Monero. Обозначим эту анонимную группу Panon. Итак, для каждого адреса, входящего в эту группу, существует обязательство, которое определяется примерно так, где g и h - это, опять же, генераторы. Предполагается, что дискретный логарифм между ними неизвестен. yi является секретным ослепляющим фактором, ai - это сумма, ну а Ci будет обязательством по сумме ai.

Таким образом, это означает, что бирже известны секреты yi и ai для каждого адреса, которым она владеет, а это значит, что адрес принадлежит бирже. Таким образом, чтобы создать доказательство резервов, нам нужно каким-то образом доказать, что для данной анонимной группы, по сути, являющейся просто кучей адресов, существует некоторое количество обязательств. А в этом наборе обязательств имеются определённые обязательства, секреты к которым нам известны.

Поэтому для первого необходимого нам вычисления берётся случайная скалярная величина, zi, и вычисляется вот это значение . Мы называем это модифицированным обязательством, поскольку оно похоже на определение обязательства. И если вам видно, мы производим как бы условное вычисление, где модифицированное обязательство - это просто, где zi - случайная и известная только нам скалярная величина. Таким образом, zi - это, опять же, секрет, который известен бирже. И если адрес принадлежит бирже, то это просто генератор zi, используемый для вычисления открытого ключа. Если же адрес не принадлежит бирже, то мы также умножаем его на обязательство, связанное с этим адресом. И скоро мы увидим, зачем это делается.

Итак, если взглянуть на имеющиеся у нас модифицированное и исходное обязательства, видно, что между ними существует неявная связь. И если вы попытаетесь вычислить эту величину, то обязательства будут умножены на обратную модифицированному обязательству величину. Если адрес не принадлежит бирже, то модифицированное обязательство и связь между обязательствами немного проще. В этом случае крайний член отсутствует. Но если биржа владеет этим адресом, это становится обязательством по сумме ai с нескольку иным ослепляющим фактором, который теперь выглядит как yi – zi, и который мы пока проигнорируем. Но суть состоит в том, что это модифицированное обязательство, умноженное на обратное модифицированному обязательству величину, становится как бы обязательством по первоначальной сумме ai для адресов, которыми владеет биржа. Для адресов, которыми она не владеет, оно становится обязательством по нулевой сумме.

Теперь самое интересное: если мы суммируем всё это по кругу, то получим некоторый член g, g в какой-то там степени, а член h будет содержать некоторые суммы. И эти суммы будут соответствовать тем, которые принадлежат бирже. Таким образом, это становится неким обязательством по общим резервам или общим активам, принадлежащим бирже. А это именно то, что мы пытались сделать, верно? Если у нас есть обязательства по активам и если мы предполагаем, что у нас есть криптографические обязательства по обязательствам биржи перед клиентами, биржа может создать доказательство диапазона, чтобы доказать, что умножение обязательств по активам на обратное обязательство не даёт нулевого результата. Итак, это решает ещё одну проблему, но нам как криптовалютной бирже всё ещё необходимо доказать, что модифицированное обязательство было вычислено правильно.

И как нам доказать это с помощью кольцевых подписей? Прежде всего, модифицированное обязательство имеет определённую и очень простую структуру: zi можно представить как закрытый ключ, а модифицированное обязательство, если адрес принадлежит бирже, становится открытым ключом. Если же адрес не принадлежит бирже, вы можете снова считать это парой ключей, где закрытый ключ - это снова zi, а открытый ключ - это модифицированное обязательство, умноженное на обратную величину исходного обязательства. Смысл состоит в том, что мы можем вычислить кольцевую подпись, используя эти два открытых ключа, зелёный и оранжевый. Зелёным обозначены адреса, принадлежащие бирже. Оранжевым - адреса, которые бирже не принадлежат. И если мы можем предоставить кольцевую подпись, то, по сути, мы доказываем, что структура модифицированного обязательства была выполнена правильно. Потому что если бы биржа был неизвестен ключ zi, или же структура была бы нарушена, то биржа не смогла бы выдать кольцевую подпись. Таким образом, это самая обычная кольцевая подпись.

Единственное, что остаётся доказать в случае с протоколом MProve - это то, что адреса, которые были включены в нашу анонимную группу, ещё не были потрачены. И, как уже было сказано,  для доказательства того, что адрес ещё не был потрачен, используется образ ключа. Значит, нам каким-то образом нужно раскрыть образ ключа исходного адреса, принадлежащего бирже. И опять же, для этого мы используем кольцевые подписи с двумя открытыми ключами. Один из них, Pi, показанный зелёным цветом, соответствует адресу, принадлежащему бирже. А оранжевым показаны адресов, не принадлежащие ей.

Зачем же нужна эта кольцевая подпись? Потому что нам нужно доказать, что в том случае, если адрес принадлежит бирже, этот адрес соответствует правильному образу ключа. Но мы не можем просто взять и раскрыть образ ключа напрямую, поскольку это также раскроет, какие адреса принадлежат бирже. Поэтому мы выдаём кольцевую подпись. Таким образом, для внешнего наблюдателя всё сводится к попыткам угадать, какой адрес принадлежит бирже, и вероятность угадать при этом равна 50%. И у нас есть эта вторая связываемая кольцевая подпись, поскольку нам также нужен образ ключа, соответствующий второй кольцевой подписи, чтобы биржа могла доказать, что зелёный адрес Pi не был потрачен ранее.

Таким образом, по сути, это довольно простой усовершенствованный протокол, у которого всё же имеются очень важные недостатки. Один из них заключается в том, что, как и в случае с обычной транзакцией Monero, этот протокол также масштабируется линейно в зависимости от размера анонимной группы. Но проблема состоит в том, что размер анонимной группы в случае с биржами должен быть очень большим, потому что биржа хочет раскрывать как можно меньше информации о том, какими адресами она владеет. Поэтому линейное масштабирование - не самое лучшее решение в данном случае, поскольку оно налагает некоторые ограничения на размер анонимной группы. Но более важной проблемой является раскрытие образа ключа, соответствующего адресам, которыми владеет биржа.

Почему это проблема? Потому что если биржа, допустим, тратит с адреса, который был включён в доказательство резервов в 2020 году, а затем она тратит средства с того же адреса в 2021 года, любая будущая транзакция покажет, что биржа пытается потратить деньги с определённого адреса, что очень опасно с точки зрения сохранения приватности данных биржи. Поэтому такое решение нецелесообразно. Но версия протокола MProve+ решает этот недостаток.

Ключевая идея MProve+ состоит в том, что мы рассматриваем данную проблему в несколько ином ракурсе. Это довольно математический подход, но я попытаюсь объяснить его на самом поверхностном уровне. Подход заключается в определении двоичных векторов, соответствующих адресам, принадлежащим бирже. Так, например, зелёный адрес на второй позиции принадлежит бирже. Поэтому он будет соответствовать первому двоичному вектору. Аналогичным образом мы можем определить и остальные двоичные векторы. Ослепляющий фактор y и суммы будут известны бирже только для тех адресов, которыми она действительно владеет. Также у нас будут обязательства, соответствующие всем открытым ключам из нашей анонимной группы, и, конечно же, открытые ключи, связанные с нашей фактической анонимной группой. Есть ещё пара вещей, таких как образы ключей, соответствующие, по-моему, видимым образам ключей для каждого из открытых ключей, которые я не показал на слайде. Но это, вроде как, уже вполне очевидные вещи.

Итак, идея состоит в том, что если мы сформулируем задачу таким вот образом, то сможем сказать, что конкретное обязательство можно вычислить как вектор обязательства, возведённый в степень двоичного вектора. Так, например, в случае с обязательством g, которым владеет биржа, она может вычислить его, просто взяв вектор C. Он может возвести его в степень двоичного вектора C. Аналогично, она может зафиксировать отношение между адресами, которыми владеет, генератором и секретным ключом. Аналогично зафиксировать и отношение между образами ключей для адресов, которыми владеет.

Итак, в данном случае Ij - это образ ключа, ej - секретный ключ, соответствующий адресу. И смысл всего этого в том, что мы можем объединить все эти отношения в одно. Переход из отдельных уравнений в одно уравнение немного затруднителен. Но идея заключается в том, что вы просто случайным образом комбинируете эти уравнения случайным образом и в результате получаете отношения между всеми этими открытыми векторами. Вектор C, вектор P, вектор H - всё это открытые векторы. А их степени являются секретами двоичного вектора ej. Справа, опять же, у нас есть открытые g, h, I, а их степени закрыты. И мы получаем отношение внутреннего произведения между степенями или секретами. Идея состоит в том, чтобы векторизовать все отношения и просто объединить их в одно уравнение. И вот как выглядит это уравнение. Оно взято из статьи. В данном случае я не стал расширять его.

Итак, когда у нас есть такое единое уравнение, где вся открытая информация находится в основании, а вся закрытая информация - в степенях, мы можем использовать один очень мощный инструмент, взятый из  официального документа Bulletproofs. Кажется, первоначально он упоминался в работе, написанной ещё до появления Bulletproofs. Но многие считают, что этот инструмент появился именно благодаря Bulletproofs. Это переменная внутреннего произведения. Если посмотреть на переменную в нашем случае - вся открытая информация находится в основании, а все секреты - в степенях с некоторым отношением внутреннего произведения между секретами. И поэтому мы можем использовать ту же переменную в данном случае. Как обещал, я не буду вдаваться в подробности, но переменная внутреннего произведения - довольно мощный инструмент, поскольку сокращает размер доказательства с линейного до логарифмического по отношению к общему размеру. Общий размер, обозначенный здесь как заглавная N, является общим размером наших векторов. В данном случае это количество секретов, умноженное на количество адресов, входящих в нашу анонимную группу. Таким образом, у нас есть ej для всех j, принадлежащих бирже. И размер каждого ej равен N, а количество векторов ej - это количество адресов, которыми владеет биржа. Таким образом, заглавная N будет в N раз больше количества адресов, принадлежащих бирже. То есть размер доказательства в данном случае также линейно растёт с увеличением размера анонимной группы. Но постоянный коэффициент масштабирования является почти двенадцатикратным. Так что мы значительно сокращаем размера доказательства.

В целом, доказательства MProve+ в 8 раз  меньше, чем доказательства MProve. Да, это просто график изменения размера доказательств. Время верификации относительно генерации доказательств в MProve+ больше, чем в MProve, потому что протокол MProve был предельно простым. Он использовал стандартные кольцевые подписи, связываемые кольцевые подписи, но в случае MProve+ происходит экспоненциальный рост необходимых вычислений, и поэтому в MProve+ работа как верификатора, так и проверяемой стороны намного значительней. При этом верификация доказательства далеко не так обременительна, как действия доказывающей стороны. Несмотря на то, что оба процесса линейны, существует множество возможностей для пакетной обработки, как и в случае с обычными транзакциями Monero. Таким образом, верификация доказательств происходит почти в 8 раз быстрее, чем их создание.

Итак, MProve+ решает критическую уязвимость или проблему MProve и делает довольно доказательства резервов весьма практичным решением для бирж. Как я уже сказал, размер доказательств гораздо меньше, потому что в какой-то момент биржа опубликует эти доказательства в блокчейне, а следовательно, размер доказательств связан с определёнными издержками. Поэтому всегда предпочтительней использовать доказательства меньшего размера. Поэтому уже сегодня биржи могут использовать MProve+.

Однако достаточно ли практично это? Это всё ещё вопрос, поскольку, по нашим расчётам, на создание доказательства для анонимной группы, включающей в себя 50 000 адресов, сегодня уходит почти два часа. Так что для такой крупной биржи, как Binance, если она владеет, скажем, 1 000 UTXO или адресов Monero, она обязательно захочет, чтобы размер анонимной группы был как можно больше. Но для генерации доказательства, пусть даже и на домашнем компьютере, требуется целых два часа. А если в качестве анонимной группы взять, например, весь набор UTXO, потому что это было бы идеально с точки зрения биржи, поскольку позволило бы обеспечить максимальную приватность, то это станет практически невозможным, если только у вас нет очень мощной машины. И всё равно на создание доказательства уйдут часы.

Поэтому мы постоянно работаем и пробуем использовать новые протоколы, такие как SNARKs и STARKs, чтобы понять, что позволит нам ускорить время создания доказательства и его верификации. Время верификации также очень важно, потому что если эти доказательства резервов будут включаться в блокчейн, то в какой-то момент они должны будут подтверждаться майнерами или валидаторами. Поэтому одним из проектов, в котором мы добились значительного прогресса, является разработка доказательства резервов с использованием системы доказательств Nova специально для Monero. Мы опубликуем результаты, как только они появятся.

И последнее - это наши варианты реализации: один написан на Rust, а другой выполнен в исходном коде Monero. Так что, пожалуйста, не стесняйтесь, изучайте и задавайте нам вопросы.
