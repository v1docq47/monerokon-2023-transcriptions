# Юрай Беднар

_**Анализ трафика предпринимателей, использующих в расчётах Monero, с помощью простого метода анализа блокчейна**_

[https://youtu.be/-sTT84Up7FY](https://youtu.be/-sTT84Up7FY)

---

_**Юрай:**_ Итак, добро пожаловать, доброе утро. Рад, что вы пришли, и давайте сразу перейдём к расчётам. Я подсчитал, что здесь в каждом ряду имеется по 10 мест, или по 20 мест в каждом ряду, и у нас есть 10 рядов. Таким образом, в зале помещается около 200 человек. Пожалуй, зал заполнен на 50%. То есть не все места заняты. И если, чтобы попасть на это мероприятие, в среднем все заплатили по 100 евро, то доход от его организации должен составить что-то около 10 000 евро. Конечно, нужно учитывать спонсоров, но и без этого мы легко можем представить себе бизнес-модель этой конференции. Сколько стоит организовать подобную конференцию? Каковы расходы? И так далее. И я этим занимаюсь постоянно. Это уже подобно обсессивно-компульсивному расстройству. Я сажусь в самолёт, пересчитываю количество мест и говорю: «Так, какова средняя цена билета? О, хорошо, значит, один рейс стоит столько-то».

И я подумал, а не поступают ли люди так же в отношении меня. Ведь я предприниматель, и принимаю крипту. И я очень осторожен в этом вопросе. Так, например, если я принимаю Bitcoin, то я буду тратить каждый UTXO, каждый платёж отдельно, чтобы выходы моих клиентов не попадали в одну транзакцию. Чтобы один клиент не мог проверить, каков баланс другого клиента и так далее. Я занимаюсь этим уже много лет, но в случае с Monero я подумал: «О да! Тут и так всё происходит приватно. Мне не придётся больше заниматься всем этим». Ведь суть Monero заключается в приватности этой монеты.

А несколько месяцев назад я покупал кое-что у продавца, который принимал Monero. Конечно же, я выбрал Monero, чтобы оплатить услугу. Торговец принимал Bitcoin, Litecoin, Ethereum и Monero. В случае с Bitcoin, Litecoin и Ethereum я просто просмотрел блокчейн, чтобы увидеть, рассчитать, сколько людей оплатили ту же услугу, чтобы прикинуть, насколько успешен его бизнес? Я в этом был сильно заинтересован, поскольку продавец занимался почти тем же, чем занимаюсь я, по крайней мере, в той же сфере, но не по содержанию. Но я подумал: «Ладно, а что если половина клиентов будет платить в Monero? Тогда я не буду знать их точного количества».

Я задумался над этим и решил всё выяснить. Всё это очень просто. В этом нет ничего революционного. И всё это уже давно известно. Но давайте посмотрим, как это можно сделать на практике, чтобы оценить оборот продавца.

Итак, у нас есть некоторые допуски. Продавец принимает Monero, и я допускаю, что они оказываются в одном и том же кошельке, статический адрес который в данном случае использовал продавец и просил при этом клиента предоставить хэш транзакции, идентификатор транзакции, что немного безопасней, чем в случае с Bitcoin, благодаря наличию скрытых адресов. При использовании Bitcoin вы увидели бы, что продавец получил деньги на этот адрес, увидели бы идентификатор транзакции, просто воспользовавшись блокчейн-экмплорером. Или же вы могли бы использовать что-то вроде BTCPayServer с плагином Monero, генерирующим подадреса. Но все они всё равно принадлежали бы одному кошельку. Так что схема работает в обоих случаях.

Итак, я хочу оценить оборот, то есть доход продавца. Конечно, мы не увидим суммы, но если он использует другие криптовалюты, то это будет сделать довольно просто. Я просматриваю транзакции Bitcoin, Ethereum, Litecoin, оцениваю средний размер заказа. Опять же, это тоже может отличаться в случае с людьми, которые расплачиваются Monero. Возможно, такие покупатели демонстрируют иное поведение. Но в целом это вполне безопасный допуск. В данном случае всё было намного проще, поскольку речь шла только об одном товаре, который продавался по одинаковой цене для всех. То есть каждый заказ имел абсолютно одну и ту же цену. Например, это может быть платная подписка на рассылку, доступ к онлайн-курсу или электронной книге, и тогда вы сможете увидеть, что продавец зарабатывает столько-то за один заказ.

Как правило, кошельки Monero либо не подразумевают наличия контроля над монетами, либо, если такая функция всё же имеется, люди не используют её. Кто из вас использует функцию контроля монет при проведении транзакций Monero? отлично! У нас есть два героя! В случае с Bitcoin это делать просто необходимо, и мы делаем это каждый раз. Я уже говорил, что делаю это в случае с каждой монетой, чтобы клиенты не пересекались в рамках одной транзакции. Я перемещаю выходы в какую-нибудь другую сеть, и в моём случае это Lightning. Но продавцы, принимающие Monero, как правило, помещают всё в один кошелёк и перемещают из него монеты куда-то ещё лишь время от времени. И это создаёт возможность для атаки.

Обычно продавцы берут средства и переводят баланс на другой кошелёк. Например, если у вас есть платёжный шлюз, ваш собственный или сторонний, и если он ваш, то это может быть BTCPayServer, и вы захотите вывести через него средства, возможно, на аппаратный кошелёк, и если не на аппаратный кошелёк, то куда-то ещё. И в этом случае по причине наличия подадресов вам понадобится довольно много времени, потому что случается так, что довольно много людей заходят на страницу оформления заказа, но при этом не проводят оплату. Поэтому, если вы генерируете подадреса, вы не сможете получать средства на обычный кошелёк, который используете ежедневно, потому что вам придётся сканировать большое количество подадресов. Многие люди так и поступают. Конечно, они также могут потратить монеты, и это тоже о чём-то вам скажет. Может, это и не позволит узнать каких-то точных цифр, связанных с заказами, но вы увидите минимум. И можно будет смело предположить, что оборот составляет эту сумму или больше.

Транзакция «очистки» обычно содержит больше входов, поэтому она выделяется в блокчейне. Это не обязательно, но может быть и так. Но мы можем перевести продавцу несколько платежей. Например, разбить один платёж на два выхода. И он поступит в виде одной транзакции. Продавец даже будет видеть всего одну транзакцию. В своём кошельке он увидит ту сумму, которую ожидал получить. И при одном только виде такой транзакций ни у кого не возникнет никаких подозрений. Кошелёк, как правило, просто сообщает, что получил 100 долларов или одну Monero, или какую-то другую сумму.

Также при размещении нескольких заказов вы можете распределить ваш адрес или подадреса. Вы можете отправить несколько небольших сумм в XMR на один адрес. Или же создать один или несколько фальшивых заказов. В данном случае допуск сводится к тому, что продавец потратит эти деньги в одной транзакции. То есть, использует эти выходы в кольце какой-то одной транзакции. Конечно, этот допуск будет действовать  в течение определённого периода времени. Возможно, между первой и последней транзакцией. Но мы можем продолжить, если увидим, что торговец «очистил» все монеты — в этом случае атаку можно повторить. А затем мы можем оценить, в зависимости от того, как часто, скажем, раз в неделю, он «очищает» баланс, каков его оборот.

И теперь давайте посмотрим, как это сделать на практике. Это реальный пример. Сейчас я деанонимизирую свою транзакцию, но я уже воспользовался вспениванием, а потому не боюсь раскрывать вам эту информацию. Итак, у нас имеется одна транзакция с одним выходом, и есть вторая транзакция со вторым выходом. Оба выхода являются нулевыми, вот, как выход первой транзакции. Это то, что я отправил продавцу.

И как мне заполучить транзакцию «очистки» из блокчейна? К сожалению, я не нашел нужного блокчейн-эксплорера. Возможно, вы сможете мне помочь. Это значительно упростило бы задачу. Никакого блокчейн-эксплорера Monero с открытым исходным кодом или открытым доступом, позволяющего искать выходы, просто не существует. Нам просто нужно написать немного кода. А это просто Gist у меня на GitHub, так что вы можете сделать всё сами. Всё очень просто. Просто измените некоторые параметры.

Прежде всего, нам известна высота блока нашей транзакции. Нам не придётся просматривать весь блокчейн. Мы знаем, с какого места начать — через 10 блоков после того, как произошла вторая транзакция. Именно тогда монеты могут быть потрачены. Ещё один момент — в Monero вы не идентифицируете выход шестнадцатеричной строкой, а присваиваете ему индекс. То есть индексы просто являются пронумерованными выходами в блокчейне. Итак, сначала вам нужно преобразовать шестнадцатеричную строку в индекс. Для этого есть небольшой код. Кстати, я не использовал какого-либо программного интерфейса Monero. Я хотел, чтобы ChatGPT написала код за меня, и я потратил один час своей жизни впустую, потому что ChatGPT создавала какие-то призрачные интерфейсы, которые могли бы быть очень полезны, но при этом по факту их не существовало. Итак, вы можете проверить, та ли это транзакция. Вы можете сравнить ключ, открытый ключ скрытого адреса и индекс.

И ещё один момент: индексы выходов относительны. Поэтому вам придётся прибегнуть к сложению. Выходы упорядочены по индексу или времени. Поэтому вам нужно преобразовать эти относительные индексы в транзакции в абсолютные. И я написал короткий код, который сканирует блокчейн и ищет транзакцию, содержащую участников кольца. Итак, вот индексы, и я использую конкретно этот. Да. Это индексы, это средняя высота, а затем я просто очень медленно просматриваю все транзакции за неделю, и ищу ту, которая содержит оба этих выхода в качестве участников кольца, использующего этот вход. И вот, что я получаю после запуска.

Таким образом, отображаются не только те транзакции, в которых присутствуют оба выхода. Но в этой транзакции, которую я вижу, есть оба. Остальные бесполезны. Но эта — хороший кандидат. Поэтому мы можем проверить её. Мы можем увидеть, когда она была добавлена. Это очень важно с точки зрения оценки времени, ведь мы хотим выяснить доход за определённый период. Мы хотим узнать доход за три дня, за неделю или за месяц, или за какое-то другое время. Мы проверяем, действительно ли выходы присутствуют в кольцах. Конечно, это может быть совпадением, но чтобы уменьшить вероятность такого совпадения, можно создать больше двух выходов. Можно создать пять, и тогда это точно не будет совпадением. Так что с большой долей вероятности можно утверждать, что это транзакция «очистки», проведённая продавцом.

Итак, что это даёт нам? Здесь есть четыре входа. Я знаю, что два из них — мои, но я являюсь покупателем, так что я считаю и себя. Я знаю, когда выходы были созданы, каково время создания самого старого выхода, и мы получаем грубую оценку по трём заказам, и это уже похоже на «очистку» в течение дня. Это один день — продавец фактически подтвердил мой заказ через два часа после транзакции «очистки». Таким образом, по приблизительной оценке, у этого продавца в данном случае было около трёх заказов за день. Конечно, я могу повторить процедуру, потому что бывают дни получше и дни похуже. Если погода, например, будет хорошей, возможно, люди не станут покупать товар за Monero, а сделают это где-то вне дома.

Итак, теперь мы делаем то же предположение, что и в самом начале. Товар стоит, допустим, 100. Значит, оборот торговца составляет около 300 за день. Я также учитываю Bitcoin, Ethereum и Litecoin, которые я только что увидел с помощью блокчейн-эксплорера. Мне больше ничего не нужно, и мы можем всё повторить снова.

Таким образом, такой анализ предполагает проведение активной атаки. То есть, в отличие от публичного блокчейна, приходится что-то делать. Дело не ограничивается просмотром блокчейна. При проведении атаки вам приходится проявлять активность, что довольно хорошо, поскольку вы не можете просто обратиться в компанию, занимающуюся анализом блокчейна, чтобы узнать, что произошло год назад. Но с другой стороны, на собственном опыте я осознал, что Monero — это вовсе не волшебство, скрывающее всё происходящее в блокчейне и позволяющее утверждать: «Ведь это Monero, так что мне вообще не нужно заботиться ни о чём». Потому что если вы не хотите раскрывать подобную информацию государству или, скорее, своим конкурентам, то это может стать проблемой.

Итак, что собой представляют другие монеты в сравнении? А затем я расскажу, что можно сделать с Monero в этом контексте.

В случае с не приватными монетами на основе блокчейна требуется функция контроля над монетой. BTCPayServer, который является хорошим решением для предпринимателей, позволяет делать это непосредственно с BTC и LTC. С помощью интерфейса BTCPayServer вы можете выбирать монеты, тратить их, когда заблагорассудится, и с использованием UTXO, возможно, прибегнув к механизмам совершения свопов Lightning или Monero, с помощью какого-либо сервиса смешивания или сервиса, обеспечивающего вашу приватность.

На самом деле Lightning является прекрасным способом делать это по умолчанию. Применение Lightning требует проведения активной атаки, поскольку вы не можете ничего узнать о прошлых транзакциях. Некоторые злоумышленники в масштабах сети всё же могут соотнести ключи получателей, особенно если те используют кастодиальные кошельки, разумеется. Кошельки, использующие стороннюю маршрутизацию. Так, например, разница между Phoenix и Breez заключается в том, что Breez осуществляет маршрутизацию сам. Он создаёт маршрут, напрямую обменивается данными с узлами и, когда маршрут создан, проводит платёж. Таким образом, Breez как оператор видит процесс проведения транзакции, но не видит, кто является получателем. В случае с Phoenix вы просто говорите: «Я хочу оплатить этот счёт, пожалуйста, найдите мне маршрут», а затем история просто очищается. Так что в нашем случае можно поступить так: есть проект под названием Allen, где просто создаётся случайный ключ узла, на который будет проводиться платёж. И счёт будет оплачен только тогда, когда исходный счёт будет погашен. Так что никто и ничего при этом не увидит.

А что можно сделать в случае с Monero? Конечно, контроль над монетами — это хорошо. Если злоумышленник «распыляет» адрес небольшими суммами, вы можете просто взять эти небольшие суммы и отправить их в фонд разработки Monero или в Tor Foundation, или куда вам будет угодно. Если вы видите два выхода, относящиеся к одной транзакции, вы можете «очистить» оба. Поскольку знаете, что они, вероятнее всего, принадлежат одному и тому же человеку. Также тут хорошо то, что когда вы проводите «очистку», вы делаете это для двух выходов. Потому что проблема заключалась в том, что эти транзакции выделялись из-за наличия четырёх входов. Поэтому если вы всё время будете брать по два выхода, то это приведёт к сбою, поскольку будет включаться этот  выход, а этот выход случайно попадёт во многие транзакции. А это не сдаст злоумышленнику никакой полезной информации. Но если вы не можете использовать функцию контроля монет, хотя Feather Wallet делает это прекрасно, но если вы не можете ею воспользоваться, то лучший вариант — проводить «очистку» как можно чаще. Поэтому, когда вы получаете новый заказ, новый платёж, просто отправьте его куда-нибудь и не ждите, пока поступят другие заказы. В этом случае, конечно, вы просто можете отправить средства самому себе, произвести небольшое вспенивание, и это поможет.

Ну и, безусловно, я очень надеюсь на реализацию доказательств на базе полного блокчейна, которые могут оказаться лучше и полезнее с точки зрения смягчения атак такого рода. Большое спасибо.