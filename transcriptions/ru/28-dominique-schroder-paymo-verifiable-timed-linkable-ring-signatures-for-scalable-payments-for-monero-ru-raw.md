# Доминик Шрёдер

_**PayMo: верифицируемые временные связываемые кольцевые подписи для построения масштабируемых платёжных каналов Monero**_

[https://youtu.be/pPhm4l2rtiA](https://youtu.be/pPhm4l2rtiA)

---

_**Доминик:**_ Всем привет! Большое спасибо, что пришли, а также огромное спасибо организаторам этого замечательного мероприятия.

Итак, я - криптограф, и целью моей работы является практическое внедрение криптографических схем, то есть, их реализация в реальной жизни. Поэтому мы всегда рады получать информацию от сообщества, позволяющую нам понять текущие потребности и разработать новые практичные решения.

Поэтому я с удовольствием расскажу о криптографическом примитиве, который мы называем "верифицируемые временные связываемые кольцевые подписи". Я последовательно расскажу о том, что это такое, и где мы видим их применение в рамках создания платёжных каналов Monero, и что важно, без какого-либо нарушения схемы транзакций.

И это моя совместная с моими студентами работа, с Аравином, который сейчас работает в NTT Research, Джулио, который работает в Институте Макса Планка, и Фрицем, который по-прежнему работает со мной, а двое других, к сожалению, уже закончили обучение. Нет. К счастью, да. Но где бы они сейчас они ни были, они замечательные. Рано или поздно им приходится уезжать.

Итак, начнём с определения проблемы, правильно? В чём наша необходимость в создании платёжных каналов? На это есть как минимум три причины: безусловно, снижение размера комиссий за проведение транзакций, повышение скорости и, конечно же, экономия энергии.

Как все вы знаете, Monero в контексте проведения транзакций работает гораздо лучше, чем, например, Bitcoin, верно? В нашем случае блоки добавляются примерно каждые две минуты, а подтверждение происходит примерно через 10 блоков, а следовательно время подтверждения составляет около 20 минут. И, безусловно, если вы хотите купить что-либо в принципе, то чем быстрее это будет происходить, тем лучше.

Энергия играет важную роль в жизни каждого человека. Мы должны экономить энергию везде, где только можно. Конечно, алгоритм доказательства работы Monero хорош. Но чем меньше транзакций, тем меньше блоков добавляется в блокчейн, в результате чего экономится энергия. И поэтому вся наша мотивация в целом сводится к уменьшению количества транзакций, попадающих в блокчейн. Конечно, существуют альтернативные подходы, такие как доказательство доли владения, но, как все вы знаете, доказательство доли имеет собственные проблемы, и часто мы наблюдаем централизацию долей, так что вопрос в том, является ли эта система децентрализованной? Сейчас активно ведутся исследования в области доказательств полезной работы, и нас интересует, как мы можем использовать эти индивидуальные доказательства работы наилучшим для нас образом? Опять же, всё это открытые вопросы, требующие исследования.

Так что мы нас интересует эта проблема, по крайней мере, по трём причинам: снижение размера комиссий за проведение транзакций, повышение скорости транзакций в целом и экономия энергии.

И теперь я перейду к платёжным каналам. Расскажу, что они представляют собой в целом, как мы их используем, что такое кольцевые подписи и, конечно же, связываемые кольцевые подписи. Я не буду подробно останавливаться на конфиденциальных транзакциях, рассказывать о том, как они используются в Monero, ради сохранения простоты схемы. Вы можете модернизировать её в соответствии с основной идеей, и этого будет вполне достаточно. Мы поговорим о верифицируемых временных подписях. Это подводит нас к вопросу криптографической реализации встроенной временной блокировки, которая, например, присутствует в языке сценариев Bitcoin? Как это сделать? А зелёным выделено новое решение - верифицируемые временные связываемые кольцевые подписи, эффективные конструкции, которые нужно реализовать. И наконец, мы рассмотрим, как интегрировать их в Monero, не меняя схему транзакций?

Итак, начнём. Что такое платежи, проводимые вне блокчейна? Их основная идея заключается в том, чтобы сократить количество транзакций, попадающих в блокчейн. И платёжный канал - сейчас я всё объясняю на верхнем уровне, а затем мы постепенно будем погружаться в проблему - платёжный канал представляет собой одну транзакцию, которая открывает канал, после которой между участниками проводится множество других транзакций, и происходит это вне блокчейна. И есть ещё одна транзакция, которая закрывает канал.

Итак, самая большая проблема заключается в следующем - и я начну с небольшого примера с Bitcoin - в данном случае вся сложность сводится к необходимости каким-то образом заблокировать определённое количество монет. То есть, необходима транзакция, в которой будет сказано, что блокируется такое-то количество монет, и это именно то количество, которое можно передать за определённое время. И в целях безопасности должна быть возможность отправить эти деньги обратно. Так, например, если Элис говорит: "Я открываю канал ёмкостью, равной 10", а Боб, например, говорит, что не станет с ней взаимодействовать, то без временной блокировки эти деньги будут заблокированы навсегда. А временная блокировка, по сути, подразумевает, что через определённый период времени, если ничего не произойдёт, деньги вернутся к Элис. Чуть позже мы рассмотрим это более подробно.

А чтобы закрыть канал, мы, по сути, создаём своего рода мультиподпись, подтверждающую, что это окончательное состояние канала, с которым согласны обе стороны. Итак, мы имеем начальную транзакцию, необходимую для открытия канала, обладающего определённой ёмкостью, и финальную транзакцию в блокчейне, подтверждающую, что мы используем указанную ёмкость определённым образом.

Итак, переходим к "ингредиентам". С подписями всем всё понятно, верно? С кольцевыми подписями тоже. Но всё же давайте коротко вспомним, что это такое. Кольцевая подпись хороша тем, что вы, по сути, можете подписать документ, но ваша связь с подписью будет неясна. Другими словами, когда бы вы ни создали кольцо с определённым набором участников, единственное, что будет знать человек, проверяющий подпись, - это то, что реальный подписант является одним из участников, но не сможет сказать, кто именно. Это свойство известно как анонимность.

Но нельзя построить криптовалюту только на базе этого допуска, правильно? Почему? Понятно, что, по сути, Элис, если бы не было никакого дополнительного механизма, могла бы построить два разных кольца и произвести двойную трату. И это было бы невозможно обнаружить в данной ситуации, так? Потому что вы знаете только то, что подписантом был кто-то из участников. И это приводит нас к концепции связываемых кольцевых подписей, которые, по сути, используются как вариант и в Monero.

Идея красивая и элегантная, не так ли? И здесь по-прежнему обеспечивается свойство анонимности. То есть вы по-прежнему не знаете, кто подписал транзакцию, но в случае, если вы подпишете вторую транзакцию, другими словами, если вы попытаетесь совершить двойную трату, то эта попытка будет обнаружена. Очень красиво.

И теперь следующий необходимый нам компонент - верифицируемая временная подпись. Эти примитивы появились более 20 лет назад, и криптографы долгое время не обращали на них внимания. А потом мы поняли, что с их помощью можно делать то, что невозможно сделать иначе. Например, в значительной части с точки зрения беспристрастности. То есть, можно ли вычислить подпись беспристрастным способом? В целом невозможно, но с этими примитивами всё работает.

Так что же это такое? Ну, интуитивно она работает, как обычная подпись, то есть, Боб может создать подпись. Но у неё есть замечательное дополнительное свойство: вы можете создать обязательство по подписи весьма гибким способом. Представьте, вы можете поместить подпись в коробку и предоставить доказательство, подтверждающее, что в коробке находится действительная подпись. И самое интересное - это второе свойство. Существует определённый криптографический механизм, позволяющий открыть эту коробку за определённое количество вычислений. То есть, существует механизм открытия, называемый принудительным открытием, и после T вычислений вы можете получить подпись.

Итак, вот наши свойства: временная приватность. То есть, до истечения времени T всё остаётся внутри. Благодаря этому свойству вы не можете просто так увидеть всё это. И верифицируемость - вы можете быть уверены, что то, что находится в ящике, на самом деле является действительной подписью. Верификация происходит внутри ящика. И очень крутое свойство, взятое из головоломок с временным замком, которое, по сути, сводится к тому, что по истечении времени T вы обязательно получите действительную подпись.

Основная идея заключается в том, что в группе RSA существует последовательная операция возведения в квадрат, в отношении которой нам известно только то, что единственный способ вычислить её - пройти ровно T шагов. И вы можете выбрать своё предельное значение T относительно вычислений, необходимых в случае с этими группами. И вся идея будет заключаться в замене временной блокировки, которую Bitcoin использует в качестве скрипта, криптографически реализуемого с помощью подписей с блокировкой по времени.

Итак, давайте соберём всё воедино. Как я уже говорил, беспристрастные вычисления в целом невозможны, ну, в случае с некоторыми моделями. Но, безусловно, в рамках блокчейна с помощью данных примитивов мы можем это сделать.

Что же мы сделали для этого? По сути, мы соединили обе части, то есть ввели понятие верифицируемых временных связываемых кольцевых подписей. Мы криптографически встроили это свойство в схему. Мы нашли очень эффективную конструкцию. И это позволяет нам интегрировать её в Monero без какого-либо изменения схемы транзакций. И, конечно же, мотивация остаётся прежней - снижение размера комиссий при экономии энергии.

И теперь давайте посмотрим, как это по факту работает. На верхнем уровне - я дам вам ссылку на соответствующую статью - интерфейс выглядит очень похоже на классическую схему временной подписи, с той лишь разницей, что в данном случае мы используем схему связываемой кольцевой подписи. То есть вы по-прежнему можете создать обязательство по подписи. Теперь это связываемая кольцевая подпись. Вы можете верифицировать наличие объекта внутри коробки. И вы совершенно точно сможете открыть её после выполнения T шагов вычисления.

И давайте начнём с простейшего подхода и посмотрим, достаточно ли этого для того, чтобы напрямую реализовать платёжные каналы. И вот наш платёжный канал. Как я уже говорил, мы немного углубимся в принципы их построения. Итак, чтобы открыть платёжный канал, обе стороны, по сути, создают единый адрес, с которого деньги можно будет перевести только в том случае, если Элис и Боб подпишут его. Ёмкость канала составляет 30 монет, и он будет работать в течение времени T. Данное время на первом этапе, конечно, задавалось с помощью журналов временной регистрации, которые, например, используются в Bitcoin.

И теперь стороны могут взаимодействовать между собой и обновлять канал. Это означает, что они создают транзакции для перевода, например, одной монеты с этого совместного адреса Бобу. И стороны делают это, скажем, на протяжении 30 транзакций. Таким образом, стороны проводят между собой ряд транзакций, а эта единственная транзакция отправляется в блокчейн. Каждая транзакция подписывается с помощью связываемой кольцевой подписи Monero. Опять же, для упрощения мы опускаем конфиденциальную часть. И чтобы закрыть канал, в идеале Боб размещает в блокчейне последнюю транзакцию, означающую завершение взаимодействия. Другими словами, для проведения 30 платежей нам понадобится всего две транзакции, которые попадут в блокчейн.

К сожалению, в Monero нет скрипта журнала временной регистрации, и поэтому данный простои и прямой вариант реализации не работает. И вот тут в игру вступают подписи VTLRS, которые будут выглядеть примерно следующим образом. То есть нам нужно каким-то образом встроить эту функцию, чтобы транзакции не отправлялись напрямую в блокчейном, и это будет работать следующим образом.

Обе стороны создают транзакцию возмещения, которая говорит: "Перевести 30 монет с этого совместного адреса Элис". Ведь когда Элиса запускает канал, она хочет быть уверена, что если что-то пойдёт не так, она получит свои деньги обратно. И поэтому этот первоначальный платёж, эти средства, будут отправлены с совместного адреса обратно Элис.

А теперь Боб, по сути, пакует этот совместный адрес в головоломку с временным замком. И, если мы правильно выберем значение T, эта головоломка гарантирует, что Элиса сможет возместить эту транзакцию, если что-то пойдёт не так, и отправит её в блокчейн, чтобы получить свои деньги обратно.

С другой стороны, Боб при создании того же платёжного канала, о котором мы говорили раньше, захочет убедиться, что до истечения времени T он указывает правильное состояние канала, иначе адрес просто пропадёт. Итак, Элис начинает решать головоломку, и если окончательная транзакция не появляется в блокчейне, она получает свои деньги обратно.

Так как же мы можем реализовать всё это непосредственно в Monero? Как я уже сказал, для простоты мы не будем рассматривать механизм проведения конфиденциальных транзакций, но он работает точно так же.

Как вы знаете, это базовая структура, где секретные ключи - это x, а открытый ключ - это g в степени x. И мы, по сути, выбираем кольцо, в которой входит, скажем, n участников. Это простой вариант реализации, где, конечно же, первая часть - это связующий тег, который необходим для выявления попыток двойной траты. А здесь, внутри, находится цикл, который затрагивает всех участников, и мы, по сути, создаём некую агрегированную форму подписи Шнорра, которую потом, в конечном счёте, можем верифицировать.

Итак, нам нужно каким-то образом встроить нашу идею головоломки с временным замком в эту структуру. Предлагаемые нами решения основаны на предыдущей работе, которую мы опубликовали в CCS 2020. Мы задавались вопросом, как повысить эффективность временных подписей, и нашли множество конструкций, основанных на подписях Шнорра, ECDSA и BLS.

Основная идея заключается в следующем. Мы берём подпись, обладающую необходимыми нам хорошими алгебраическими свойствами. Затем мы засекречиваем это значение по схеме Шамира t-из-n. Для тех, кто не знает, что это такое, но я полагаю, большинство всё же знает: вы делите секрет на несколько частей. Каждая отдельная часть сама о себе не раскрывает никакой информации о секрете, который является подписью. И вам нужно только пороговое значение t. Как только вы получите значения t, вы сможете восстановить исходное значение. И наша идея состояла в том, чтобы, по сути, заблокировать по времени каждую из этих частей секрета и предоставить доказательство правильности, которое неинтерактивно подтверждало, что t – 1 из этих головоломок было построено правильно. Это доказательство необходимо для того, чтобы убедиться в том, что сторона, создавшая эту головоломку, не жульничает. Таким образом, мы получаем обязательство и доказательство π, где доказательство π соответствует открытым головоломкам.

В этом и состоит суть идеи. И если рассмотреть структуру поближе, мы видим доказательство, неоткрытые головоломки и открытые части подписи.

И следующая хорошая идея связана с верификацией и ложным открытием? Сначала мы проверяем действительность всех подписей. И это делается вполне эффективно, поскольку это подпись Шнорра, или подпись типа подписи Шнорра. На следующем этапе решаются головоломки, чтобы получить ещё одну часть. И этого достаточно, поскольку до этого у вас было t – 1 значений, а с помощью этих t частей мы затем можем восстановить подпись.

И здесь мы взяли за основу другую работу Аравинда и Хулио, которая была опубликована в Crypto19. Хорошо, что эти головоломки гомоморфны, и их можно просто сжать. И это работает довольно эффективно.

Но как нам всё это интегрировать? Идея заключается в том, что если внимательно взглянуть на структуру подписи, то вместо того, чтобы напрямую выдавать это значение как нулевое, выдаётся обязательство. И это обязательство будет иметь точно такую же структуру, как здесь. И с помощью этой структуры мы можем, по сути, красиво встроить это в нашу головоломку. И это соответствует тем прошлым идеям, о которых я только что рассказывал.

Что касается производительности, с точки зрения такого теоретика, как я, всё выглядит просто потрясающе. Мы, безусловно, реализовали это в локальной тестовой сети, и время вычисления обязательств составило около 568 миллисекунд. Время верификации - около 467 миллисекунд. Я вижу, у меня заканчивается время. Но в целом, если посмотреть на время вычислений с учётом различных вариантов задержки, то мы получили почти 94 000 подписей в транзакциях на ядро процессора за две минуты.

На этом всё. Моё время истекло. Благодарю за внимание. Надеюсь, я смог заинтересовать вас, и теперь с нетерпением жду ваших вопросов. Спасибо.
