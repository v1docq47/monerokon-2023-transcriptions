# Justin Berman

_**Monero Light Wallets: Today and in the Future**_

[https://youtu.be/MYzZ1DzSWCY](https://youtu.be/MYzZ1DzSWCY)

---

_**Justin:**_ Hello! So I go by J-Berman on GitHub and Matrix. So today, I'm gonna be talking about Monero's light wallets as they exist today and as they would exist in a proposed future upgrade that is currently in development, Seraphis/Jamtis, it's been mentioned quite a few times over the course of this weekend. And so just a quick preface how I'd draw these analogies.

So if a Monero full wallet where you are running your own node at home or wherever, and running your own light wallet server, running your own infrastructure, and your wallet is pointing to your own node, if that privacy is a fortress, then I would say this proposal and what I'm gonna be talking about in this future proposed upgrade would be more like a chain link fence with a barbed wire on top. So it's not the ideal. And then current light wallets, I'd say, are more like a gate that anybody can kind of walk into with like very, very virtually no protection.

So, today's light wallets. So basically in Monero today, and I'm sure anyone who has used Monero has experienced this, you have to scan every transaction in the blockchain since you last opened your wallet in order to identify your transactions. And so let's say you haven't used Monero in a week or a few weeks, then you could end up sitting there while your wallet is downloading and scanning every single transaction and if you haven't used your wallet in a while, this is something that can take quite a bit of time.

And so the idea with light wallets is that you can offload this scanning to a separate server called a light wallet server. It does all of this scanning for you, and then as soon as you open your wallet on your phone or wherever, then it instantly loads and is ready to go without having to do that scanning.

And so there are a couple of open source light wallet server implementations. One is by vtnerd called Monero-lws, another by moneroexamples called OpenMonero. And so basically how they work is they identify all of your incoming Monero outputs that you've received in the past, and they can see every single amount, and they're also able to deduce your spends every time you spent Monero with high accuracy.

So the proposed upgrade is a light wallet server that's doing all the scanning that has no information as to the amounts of any of your Monero transactions and cannot definitively identify which outputs are yours received and spent with some caveats, which I will get into later on.

So the plan is basically to go through how today light wallets work, what privacy users get and what the experience is like, and then do the same thing for the proposed future light wallets.

So getting into today's light wallets at a bit of a deeper level. So in Monero, we have a private view key, which is able to see all your incoming transactions when combined with your primary address. And so what users do is they send those two off to a light wallet server, and this light wallet server identifies all of the incoming transactions, all the incoming Monero outputs a user has received and all of the transactions in which the user may have spent those outputs that they received in the past. And in this way, when a user opens their light wallet client, it downloads all that information, instantly cryptographically determines which of those spends are actually user's and the user's wallet is instantly ready to go.

And so the light wallet server technically is not able to cryptographically determine which transactions the user has spent Monero in, but it's able to deduce that with a very high level of accuracy. And then one level of privacy that light wallets do technically currently get is that the server is not able to see the destination addresses that users are sending Monero to. So it's a gate, not an open fence, but a gate, I'd say.

So, sample transaction A. So I pulled these slides actually from my Monerotopia talk last month. And basically the idea of this example that I'm gonna show is how light wallet servers with just the incoming view key are able to today deduce which transactions are the user spends with a high level of accuracy.

So here we have this example transaction A that was back in August 2022, where the user received 10 Monero in what we call an enote. So in Seraphis this terminology we're referring to outputs as enotes, so they're virtually interchangeable concepts. And so on the output side of this transaction, we've got the user receiving one enote too, worth 10 Monero. And so this is all the incoming view key is able to see in this transaction.

And then we have here all of the transactions which have included that enote too, as a potential input to their transactions in the future on the blockchain. So with Monero's current implementation of ring signatures, which have 16 ring members in them. So basically every single one of these transactions has a ring, which one of the 16 ring members in one of the rings in those transactions included that enote2 that the user received on the input side. And so there's nine of them here, actually 14 total.

So, this one, we have this yellow one standing out as having a received enote1 with 9.2 XMR. And so there's no other information about any of these other transactions on the blockchain. The only one that sticks out is this yellow one highlighted here. So this is our suspect.

And so zooming in onto this transaction, we see the user received 9.2 Monero in this transaction and taking some more numbers into account. So the user's original transaction, transaction A, we've seen 4.6 million total transactions in the Monero blockchain, and we were able to eliminate from that set of 4.6 million potential transactions where the user might have spent that enote to just this set of 14, and maybe any future ones. However, in this 14 out of 4.6 million, the user received Monero in just that one. And so we can make a pretty highly educated guess that this 9.2 Monero that the user received in this transaction that included their original enote as a potential spend, that that 9.2 Monero is likely the user's change. And so they probably spent 0.8 Monero to somebody else and that's what that unknown enote2 is in that transaction. And this 9.2 Monero is the user's receiving and so the user likely very, very highly likely, probably 99% sure the user spent 0.8 Monero on this transaction. And with that, we're able to deduce, and this property kind of extends to every single enote essentially and how light wallets are able to deduce what the user spends are.

So here I ran a simulation that, so the turquoise here, is basically all of the transactions, so I ran the simulation starting from when transaction A was included in the blockchain, all the transactions, I simulated every transaction in the blockchain and ran the decoy selection algorithm for each and noted which ones would have chosen that enote2 from transaction A as a ring member in those transactions. And you can see in this turquoise line that has a, so right, its peak there is right around 12. And then that red line there is what we actually saw, which was 14 transactions in the blockchain. So what basically the takeaway from this is that for most received enotes that a user is seeing that the light wallet server is also seeing, you could expect about 12 transactions to be spotted by the light wallet server, that the light wallet server will then send to a light wallet client, so that the light wallet client will then deduce which one of those 12 is the user spent. So. And that's basically how light wallets work today.

So on the left side here, you have the receives and basically the minimal data that a light wallet would need to download in order to display this receive and display this information to a user in their wallet. So there's about 200 bytes, 200 bytes for every received enote the user has gotten. And then for spends, where the user might have spent that enote in another transaction, the light wallet needs to send 112 bytes. And so, there's just less data needed for the spends because you don't have to determine which, like, a received in that, you don't have to do the cryptography to determine the amount in that transaction or if that transaction was actually received. So it's slightly less data, but it's 112 bytes that the light wallet server has to send. And so the total amount for every expected enote that a user receives, the user would essentially expect to download about 1.7 kilobytes per received enotes. So let's say, and that scales linearly. So user has 100 enotes that they've received. They would expect to download about 170 kilobytes worth of data, which is functionally instant loading and is why you see that you get the user experience of instant loading in a light wallet today.

So, the proposed future light wallets. And highlighting back, so the idea again is that the light wallet server is not able to see amount and is not able to definitively identify which transactions the user received or spent their enotes in. With those caveats which we'll get into.

So, functionally how they work. So, a user will instead of giving up the private view key to the server, they give up this new key we call a “find-received key”. And this find-received key, the light wallet server takes it, it scans the chain, and for every single transaction it will identify enotes which the user may have received and then might have spent. So, in some circumstances, the light wallet server is able to deduce it with 100% certainty, but in the general case, the light wallet server is not. And also it is not able to decrypt any of the amounts in any of those enotes. So basically it just eliminates from the set of all enotes to the smaller of which ones the user might have received or spent.

So basically what it does, and I don't know how many people are familiar with this concept of view tags, which are currently implemented in Monero. It basically taking that concept and applying it in light wallets as well. Basically what happens is that find-received key is picking up on one out of 256 enotes in the chain, which may or may not have belonged to the user and it's throwing away 255 enotes that the light wallet server knows for sure do not belong to the user. And so basically all received enotes are picked up definitively by the find-received key including change, which we'll get into. And so as a result, a light wallet client only needs to download about 0.4% of the data that a full wallet currently needs to download in order to scan the chain. Full wallet being the GUI wallet today, CLI or Cake or Monerujo, those are full wallets. And so this light wallet would need to download just 0.4% of the data that full wallet needs to download in order to recover user's balance.

And so here's one little engineering detail with light wallets that would be a bit different than how they currently exist. So example of a zero change spend is when a user wants to take their entire balance from their wallet and sweep it out to another location. And so basically they have zero change in that transaction, meaning that the view key wouldn't be able to pick it up and a find-received key technically wouldn't be able to pick that up either.

So what we do is, we've proposed is that all wallets include a zero amount dummy enote that the find-received key would be able to identify even in the circumstance where there is a zero change enote. That way that if you take your light wallet seed, and you order your GUI wallet seed and you restore it in one or the other wallet, or if you take your GUI seed and you restore it in a light wallet, that light wallet would still be able to identify all of the user's transactions and recover the user's balance.

And so this has a couple of downsides worth highlighting, which is that you have every single wallet would need to technically do something that they wouldn't otherwise need to do in order to benefit light wallets. So the GUI wallet would have to do something that light wallets would benefit from, that the GUI wallet wouldn't necessarily benefit from in order for the light wallet to pick up all spends in every type of transaction. And also worth relevant note is that all wallets today actually do have to do something similar, which is that they have to include a dummy amount in every transaction. So if you look at the main area of blockchain, every single transaction has at least two outputs in it. And that is to ensure that all transactions are fungible, you can't distinguish between a transaction that would be a zero change spend versus a non. And so in order to achieve that, every single wallet includes a second one, even in the circumstance where it wouldn't technically need to. And so similar to that concept, rather than just including some dummy enote, the wallet would actually have to include one that the find-received key would actually need to pick up.

And then another downside to this is that the light wallet server would then be able to pick up on more transactions than it otherwise wouldn't. So that is also another thing with today's light wallet servers. They technically, they don't get some extra information about some received incoming transaction, but if we were to apply this concept, technically the light wallet server would be able to then pick up on these transactions when they otherwise wouldn't have.

But then the upside to this is that a light wallet doesn't need to download every single key image from the server, which then brings us back to the pain point of light wallets needing to download a lot of data and then have to sit there waiting to scan. This way it can be pretty much instant, or also the light wallet doesn't need to reveal their key images to the server in order to determine their spends. And there are other ways that this could be technically kind of worked around, but each of those has its own set of downsides where this approach seems to have the least bad option, I'd say.

So proposed light wallet user privacy. So getting into those caveats that I mentioned earlier. So there are circumstances where either one of two options. One, the light wallet server can cryptographically identify transactions the user received with 100% certainty, and there are some circumstances where it can do that. And second, where it can accurately just guess which transactions or the users received enotes and spends via just analyzing what's going on on the server and some other caveats we'll get into.

So my view and my opinion is because of these pretty significant caveats to light wallets, users should still default to if they're not running, if you aren't running your own node, which you should be, everyone should be running their own node, if not, the default still shouldn't be light wallets because these caveats are pretty severe. Unless you're running your own light wallet server, you should still not be defaulting to this setup, in my view.

So the circumstances where the server can determine a user's incoming enotes with 100% certainty is if one, the user receives two plus enotes to the same address which is one of the things that Monero tries to protect users from at the protocol level with stealth addresses where you can't look on the blockchain and see, you can't look up an address on the blockchain and identify user transactions like that where you can with Bitcoin or Ethereum or any other non-privacy focused chain. So unfortunately with this, you have this that kind of gets rid of that concept where if the light wallet server has access to this find-received key and the user receives two enotes, the light wallet server is able to detect those incoming enotes with just that find-received key. There's nothing that goes on chain that anyone can look up, but that find-received key is enough to be able to say, okay, these are definitely received enotes.

And then the other circumstance there is if the light wallet server knows the user's address, it ruins that concept as well. So even if the user received one enote to the same, to one address, the light wallet server is able to see that if the light wallet server knows the user's address. Which means that anyone who's transacting with you also has some level of responsibility in your privacy to not go out and share that address with the world either. Or you should, like, if you post your address on Twitter or whatever, you post it somewhere public, you would therefore be, the light wallet server would be able to pick up on your receives using just your address.

And so one way to alleviate this, that downside, is that wallets, and especially light wallets, should be randomly generating unique addresses for users to use on each receive, to try and alleviate that. It's not perfect. You know, if a user takes their address and just posts it somewhere, it's not gonna help you in that circumstance. But as a default behavior, wallet could generate unique addresses for every single receive. And Jamtis as support, Jamtis is part of that proposed upgrade to Monero, has support for random address generation where current wallets have a bit more, it's a bit more challenging to actually support that feature today. So Jamtis would make it easier to be able to randomly generate addresses such that this could be avoided with, or at least mitigated to a certain extent.

So, and then there's circumstances where the server can guess. So this prior slide is talking about circumstances where the server can tell with 100% certainty and then there are circumstances where the server can still just guess with making accurate deductions. First is, you know, if the server is just logging when the user signs in and requests their fine received enotes and then immediately goes request, they want to construct a transaction, they fetch decoys either from the server or somewhere else, fetch fee information from the server somewhere else, and then the transaction goes on chain right after that, where that has a that match, that one out of 256 match, the server sees it. The server can likely pinpoint the user's transactions from that, just by that, and I mean, if the user is just submitting their transactions straight to the server anyway, the server is gonna be picking that up anyway. So there are these circumstances that are difficult to avoid, where the server is going to gather information where it can just deduce with analysis the user's transactions are these.

So another is, for example, a user receives multiple change outputs in a single transaction, like Monero's recent pocket change feature. So this concept is designed for, so currently when you receive some Monero, you can't spend it for 10 blocks, and that offers rework protection to users, and it's a UX hurdle with Monero that is just exists as it exists today. And as a result of that, user can get around it. Get around it today is with this feature called Pocket Change, which spreads the change enotes in every transaction. So the user has multiple enotes from which to spend. And so if they've only received Monero in one transaction, for example, and then they go and spend that Monero in the future rather than getting that locked for 10 blocks, 20 minutes, the spreading of the change enables the user to spend without other enotes in their wallet without having to wait those 10 blocks.

And it has its own set of issues surrounding privacy that they're not gonna get into now, but in this context for light wallets. So if the user is receiving multiple enotes in a single transaction, that of course would be then be picked up by the find-received key. Each of those would be picked up by the find-received key. And so you're gonna have this one transaction which could have multiple receives, and the chances of that are pretty low, one over 256 times each. So the more enotes on the output side of the transaction are received, the more statistical footprint you're leaving for the server to be able to tell: “Okay, this is a transaction in which the user received enotes”. And this can technically be mitigated with a change to the Jamtis spec, but it, that has its own set of downsides as well, but won't get into that now.

So then another instance is that when the user has a transaction with multiple inputs, this is another circumstance where they're leaving another statistical footprint that would eventually be mitigated by full chain membership proofs, but as ring signatures exist today, and as they initially were proposed as part of Seraphis, that would be another circumstance where you're leaving another statistical footprint that is then leaving more analysis for the light wallet server to do. And so basically, my recommendation would ultimately still be to run your own light wallet server and not be giving up this information to some other third party.

So we've proposed future light wallets and how the download experience would be. So on the left side, you have all of the information you'll need for the transaction level of each transaction that a user will need to download where the find-received key picks up, an enote in that transaction. You have the hash and then all the key images for each and then all that information. And then on the right side is the information on a per enote basis. And so for every enote that the find-received key identifies in every transaction, you'll need to download these bytes.

And so this works out to, so since the last year, there have been around 14 million new outputs in the chain. And so, the light wallet server identifies one out of 256 of those, which works out to around 54,500 outputs. And so, simulating this with chain data over the last year and seeing what a light wallet would have to download under this proposed scheme works out to about 15.7 megabytes. And this is constant. So even if the user has tons of received enotes, it's not going to drastically alter how much they need to download. It's gonna stay constant at around 15.7, 16 megabytes. And so that is what the user would need to download if they haven't used their wallet in the past year. And they would only need to do it once, technically, and then from then on, it's just the future, few hundred kilobytes per day of whatever it is. And so that is still virtually pretty close to about instant, and that's if you haven't used your wallet in a year for tons of internet connections and download speeds, but that varies for depending on your bandwidth.

So, basic conclusion from this, I'd say, is that the light wallets in this proposal would offer these stronger privacy properties than light wallets of today, with that very nice download user experience. And then it still has those caveats that I got into also. So that is the basic idea.

And my recommendation too from this, and I mean, I'm particularly excited about this feature in particular because I would want to run a light wallet server at home for family and friends and people within my community. That way, they're getting this instant download experience. And I'm not gonna be logging usage on my server, but even if I were, I wouldn't be able to see any amounts. And so that is a, I think, a huge step up from today's light wallet servers, where if I were running a light wallet server at home today, I would be able to get all this information just by looking into the database and seeing: “Okay, these received, I can pretty much guess a balance pretty easily with all that information, and so on.” with this, I could run this light wallet server at home and not have any information about, very little information about family and friends, and I think that kind of model is a fairly scalable model for getting more people adopting using Monero. So, questions?
